#include <xc.h>
#include "libpic30.h"

void zad1(void);
void zad2(void);
void zad3(void);
void zad4(void);
void zad5(void);
void zad6(void);
void zad7(void);
void zad8(void);
void zad9(void);

int main(void) {
    int currentProgram = 1;
    int prevRD6 = 1, prevRD13 = 1;

    AD1PCFG = 0xFFFF;
    TRISD = 0xFFFF;

    while(1) {
        int rd6 = PORTDbits.RD6;
        int rd13 = PORTDbits.RD13;

        if (prevRD6 == 1 && rd6 == 0) {
            currentProgram++;
            if (currentProgram > 9) currentProgram = 1;
        }

        if (prevRD13 == 1 && rd13 == 0) {
            currentProgram--;
            if (currentProgram < 1) currentProgram = 9;
        }

        prevRD6 = rd6;
        prevRD13 = rd13;

        switch(currentProgram) {
            case 1: zad1(); break;
            case 2: zad2(); break;
            case 3: zad3(); break;
            case 4: zad4(); break;
            case 5: zad5(); break;
            case 6: zad6(); break;
            case 7: zad7(); break;
            case 8: zad8(); break;
            case 9: zad9(); break;
        }
    }

    return 0;
}

void zad1(void) {
    TRISA = 0x0000;
    AD1PCFG = 0xFFFF;
    for (int i = 0; i < 256; i++) {
        LATA = i;
        __delay32(1000000);
    }
}

void zad2(void) {
    TRISA = 0x0000;
    AD1PCFG = 0xFFFF;
    for (int i = 255; i >= 0; i--) {
        LATA = i;
        __delay32(1000000);
    }
}

void zad3(void) {
    unsigned portValue = 0x01;
    char aktualny = 0, poprzedni = 0;
    TRISA = 0x0000;
    TRISD = 0xFFFF;
    int value = 1;

    while(1){
        switch(value){
            case 1:
                LATA = portValue++;
                if (portValue == 0xFF) portValue = 0;
                break;
            case 2:
                LATA = portValue--;
                if (portValue == 0xFF) portValue = 0;
                break;
        }

        poprzedni = PORTDbits.RD6;
        __delay32(3000000);
        aktualny = PORTDbits.RD6;

        if (poprzedni == 1 && aktualny == 0){
            value++;
            if (value > 2) value = 1;
            portValue = 1;
        }
    }
}

void zad4(void) {
    TRISA = 0x0000;
    for (int i = 0; i < 256; i++) {
        unsigned char gray = i ^ (i >> 1);
        LATA = gray;
        __delay32(1000000);
    }
}

void zad5(void) {
    TRISA = 0x0000;
    for (int i = 255; i >= 0; i--) {
        unsigned char gray = i ^ (i >> 1);
        LATA = gray;
        __delay32(1000000);
    }
}

void zad6(void) {
    TRISA = 0x0000;
    for (int i = 0; i <= 99; i++) {
        unsigned char bcd = ((i / 10) << 4) | (i % 10);
        LATA = bcd;
        __delay32(1000000);
    }
}

void zad7(void) {
    TRISA = 0x0000;
    for (int i = 99; i >= 0; i--) {
        unsigned char bcd = ((i / 10) << 4) | (i % 10);
        LATA = bcd;
        __delay32(1000000);
    }
}

void zad8(void) {
    TRISA = 0x0000;
    AD1PCFG = 0xFFFF;
    unsigned char kolejkaStany[] = {
        0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01,
        0x03, 0x07, 0x0F, 0x1F, 0x3F, 0x7F, 0xFF,
        0xFE, 0xFC, 0xF8, 0xF0, 0xE0, 0xC0, 0x80, 0x00
    };
    int liczbaStanow = sizeof(kolejkaStany) / sizeof(kolejkaStany[0]);

    for (int i = 0; i < liczbaStanow; i++) {
        LATA = kolejkaStany[i];
        __delay32(500000);
    }
}

void zad9(void) {
    TRISA = 0x0000;
    unsigned char lfsr = 0x3F;
    while(1){
        LATA = lfsr;
        unsigned char bit = ((lfsr >> 5) ^ (lfsr >> 1)) & 1;
        lfsr = (lfsr << 1) | bit;
        lfsr &= 0x3F;
        __delay32(1000000);
    }
}
